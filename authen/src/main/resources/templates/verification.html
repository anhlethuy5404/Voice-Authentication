<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Voice Verification</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        .container { max-width: 600px; margin: auto; padding: 2em; border: 1px solid #ccc; border-radius: 5px; }
        .form-group { margin-bottom: 1em; }
        label { display: block; margin-bottom: .5em; }
        select, input[type="file"], button { width: 100%; padding: .5em; }
        .result { margin-top: 1.5em; padding: 1em; border-radius: 5px; }
        .result.success { background-color: #e7f4e7; border: 1px solid #8fbc8f; }
        .result.error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .result.info { background-color: #e2e3e5; border: 1px solid #d6d8db; }
    </style>
</head>
<body>

<div class="container">
    <h2>Voice Verification</h2>

    <form th:action="@{/verification}" method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label for="modelId">Select Model:</label>
            <select id="modelId" name="modelId" required>
                <option value="">-- Select a Model --</option>
                <option th:each="model : ${models}" th:value="${model.id}" th:text="${model.name}"></option>
            </select>
        </div>

        <div class="form-group">
            <label for="trainRunId">Select Version (Train Run):</label>
            <select id="trainRunId" name="trainRunId" required>
                <option value="">-- Select a Version --</option>
            </select>
        </div>

        <div class="form-group">
            <label for="audioFile">Upload Audio File (.wav):</label>
            <input type="file" id="audioFile" name="audioFile" accept=".wav" required>
        </div>

        <button type="submit">Verify</button>
    </form>

    Display Result
    <div th:if="${resultUser}" class="result success">
        <h4>Verification Successful!</h4>
        <p>Verified User: <strong th:text="${resultUser.username}"></strong></p>
    </div>

    <div th:if="${resultMessage}" class="result info">
        <p th:text="${resultMessage}"></p>
    </div>

    <div th:if="${error}" class="result error">
        <h4>Error</h4>
        <p th:text="${error}"></p>
    </div>

</div>

<script th:inline="javascript">
    // Biến lưu trữ dữ liệu là trainRunsData
    const trainRunsData = /*[[${trainRuns}]]*/ [];
    const modelSelect = document.getElementById('modelId');
    const trainRunSelect = document.getElementById('trainRunId');

    modelSelect.addEventListener('change', function() {
        const selectedModelId = Number(this.value);
        trainRunSelect.innerHTML = '<option value="">-- Select a Version --</option>'; // Reset

        if (selectedModelId) {
            const filteredTrainRuns = trainRunsData.filter(run => run.modelId === selectedModelId);
            filteredTrainRuns.forEach(run => {
                const option = document.createElement('option');
                option.value = run.id;
                option.textContent = `ID: ${run.id} - Version: ${run.version}`;
                trainRunSelect.appendChild(option);
            });
        }
    });
</script>

</body>
</html>
